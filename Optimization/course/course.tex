\input{settings}
\begin{document}
\input{titlepage}
%\includepdf[pages=-,pagecommand={},width=\textwidth]{task.pdf}
\tableofcontents
\clearpage

%------------------------------------------------------------------------------
%\input{intro}

\addcontentsline{toc}{chapter}{Введение}
\chapter*{Введение}
В данной работе рассматриваются следующие задачи:
\begin{enumerate}
\item Формализация многокритериальной оптимизационной задачи, методы сведения к однокритериальной, решение с использованием Optimization Toolbox системы Matlab;
\item Поиск оптимальной стратегии принятия решений с использованием марковских моделей;
\item Решение задачи анализа потокового графа с использованием методики GERT и алгебры потоковых графов;
\item Поиск оптимальных параметров сети систем массового обслуживания.
\end{enumerate}

\input{part_1}
\input{mark}
\input{gert}
\input{CCMO}


В данной части работы была произведена оптимизация ССМО, в частности перераспределение мощностей в системе, для уменьшения очереди.\\\\
Начальные значения:\\
$\mu = (10, 10,10, 10)$\\
$L = 8.0038$\\
$L_j= (4.6255, 0.3655, 2.1179, 0.8937)$\\\\
После оптимизации:\\
$\mu = (10.5, 8, 11, 9.5)$\\
$L = 4.7109$\\
$L_j= (1.4944, 0.8743, 1.1930, 1.1491)$\\\\
Как и ожидалась, после оптимизации сети, загруженность системы понизилась.




\addcontentsline{toc}{chapter}{Заключение}
\chapter*{Заключение}
В работе были рассмотрены различные математические модели для решения задачи выбора оптимального решения.

При решении задачи стохастического программирования, было выяснено, что увеличение доверительной вероятности $\alpha$ приводит к ухудшению оценок получаемых решений по первому и второму критерию. При $\alpha = 0.5, K_{\alpha} = 0$в случае чего получается решение, совпадающее с решением задачи с детерминированными ограничениями. 

При $\alpha < 0.5$ квантиль приобретает отрицательное значение. За счет чего ограничения ослабевают(их выполнение становится менее важным), а при $\alpha > 0.5$ ограничения становяться более жесткими.\\\\
При решении задачи анализа потокового графа, было применено два подходам: с использованием методики GERT и с использованием алгебры потоковых графов. По итогу, оба метода выдали верный результат(прохождение графа). Однако, использование алгебры потоковых графов, на мой взляд, является более простым методом, так как необходимости в поиске петель различных порядков, а также в работе с W-функциями.\\\\
В задаче поиска оптимальных параметров сети системы массового обслуживания, была произведена оптимизация ССМО, путем перераспределение мощностей в системе, для уменьшения очереди. Что в итоге привело к понижению загруженности системы.

%------------------------------------------------------------------------------

%\addcontentsline{toc}{section}{Список литературы}
%\bibliography{thesis}
%\bibliographystyle{ugost2008}

%\nocite{phill}
%\nocite{Ren}

\addcontentsline{toc}{chapter}{Список использованных источников}
\chapter*{Список использованных источников}
\begin{enumerate}
\item Д. Филлипс, А. Гарсиа-Диас. Методы анализа сетей: Пер. с англ. — М.: Мир, 1984.—496 с, ил.
\item Ren, Yu. The methodology of flowgraph models. PhD thesis, The London School of Economics and Political Science (LSE). –– 2011.
\item Сиднев А. Г. Системный анализ. Часть 1 [Электронный ресурс] // Интранет-
портал ИИТУ СПбПУ. 2018. URL: http://intranet.ftk.spbstu.ru/docinfo.php?InfoFtkDocumentID= 1386947 (дата обращения: 22.04.2018)
\item Горбунов В.М. Теория принятия решений: учебное пособие. Томск: Изд-во
Томск. политех. ун-та, 2010.
\item Системный анализ и принятие решений: учебное пособие / Е.Н. Бендерская,
Д.Н. Колесников, В.И. Пахомова и др.; Под ред. Д.Н. Колесникова. 2-е изд.
СПб.: Изд-во СПбГПУ, 2001.
\item Optimization Toolbox: описание функции FGOALATTAIN [Электронный ре-
сурс] // MATLAB.Exponenta, центр компетенций MathWorks. URL:
http://matlab.exponenta.ru/ optimiz/book\_4/2/fgoalattain.php (дата обращения:
17.02.2018).
\item Таха Х. А. Введение в исследование операций: Пер. с англ. 7-е изд. М.: Изда-тельский дом «Вильямс», 2005.
\end{enumerate}


%\bibliography{thesis}
%\bibliographystyle{ugost2008}


\clearpage
\addcontentsline{toc}{chapter}{Приложения}
\setcounter{section}{0}
\section*{Приложение 1} \label{p1:1}
\textbf{Matlab cкрипт с описанием задачи}
\begin{lstlisting}[language={matlab}, caption={Скрипт с описанием задачи}, label={lst:0}]
clc; clearvars
% Параметры
Tmin1 = (18*60)*0.7;  %Минимально допустимое время работы 1 станка
Tmin2 = (20*60)*0.7;  %Минимально допустимое время работы 2 станка
Tmax1 = (18*60);  %Максимально допустимое время работы 1 станка
Tmax2 = (20*60);  %Максимально допустимое время работы 2 станка

% Целевые функции
f1 = @(X) 30*X(1) + 20*X(3); % -> max
f2 = @(X) 3*(X(1)+X(2))+12*(X(3)+X(4)); % -> min
f3 = @(X) 45*X(2) + 21*X(4); % -> max

z1 = @(N) -f1(N); % -> min
z3 = @(N) -f3(N); % -> min

% Функциональные ограничения (в данном случае только линейные)
A = [1,1,5,5;
    -1,-1,-5,-5;
    2,2,7,7;
    -2,-2,-7,-7;
    1,1,0,0;
    0,0,1,1];
b = [Tmax1; -Tmin1; Tmax2; -Tmin2;  5000; 9000];

Aeq = [];
beq = [];
% Параметрические ограничения
lb = [0; 0; 0; 0];
ub = [5000; 5000; 9000; 9000];
\end{lstlisting}

\section*{Приложение 2}
\textbf{Matlab cкрипт выделения главного критерия}
\begin{lstlisting}[language={matlab}, caption={Скрипт с выделением главного критерия}, label={lst:2}]
clc; clearvars
% Параметры
Tmin1 = (18*60)*0.7;  %Минимально допустимое время работы 1 станка
Tmin2 = (20*60)*0.7;  %Минимально допустимое время работы 2 станка
Tmax1 = (18*60);  %Максимально допустимое время работы 1 станка
Tmax2 = (20*60);  %Максимально допустимое время работы 2 станка
coeff = 0.7;

% Целевые функции
f1 = @(X) 30*X(1) + 20*X(3); % -> max
f2 = @(X) 3*(X(1)+X(2))+12*(X(3)+X(4)); % -> min
f3 = @(X) 45*X(2) + 21*X(4); % -> max

z1 = @(N) -f1(N); % -> min
z3 = @(N) -f3(N); % -> min

% Функциональные ограничения (в данном случае только линейные)
A = [1,1,5,5;
    -1,-1,-5,-5;
    2,2,7,7;
    -2,-2,-7,-7;
    1,1,0,0;
    0,0,1,1
    3,3,12,12;
    0,-45,0,-21];
b = [Tmax1; -Tmin1; Tmax2; -Tmin2;  5000; 9000; 1950; -1000];

Aeq = [];
beq = [];
% Параметрические ограничения
lb = [0; 0; 0; 0];
ub = [5000; 5000; 9000; 9000];

%% Поиск оптимумов частных критериев
startingPoint = lb;
[x, z1_opt] = fmincon(z1, startingPoint, A, b, Aeq, beq, lb, ub)
[x, f2_opt] = fmincon(f2, startingPoint, A, b, Aeq, beq, lb, ub)
[x, z3_opt] = fmincon(z3, startingPoint, A, b, Aeq, beq, lb, ub)


[x, f_val] = fmincon(z1, startingPoint, A, b, Aeq, beq, lb, ub)
\end{lstlisting}

\section*{Приложение 3}
\textbf{Решение задачи стохастического программирования}
\begin{lstlisting}[language={matlab}, caption={Решение задачи стохастического программирования}]
clc; clearvars
% Параметры
Tmin1 = (18*60)*0.7;  %Минимально допустимое время работы 1 станка
Tmin2 = (20*60)*0.7;  %Минимально допустимое время работы 2 станка
Tmax1 = (18*60);  %Максимально допустимое время работы 1 станка
Tmax2 = (20*60);  %Максимально допустимое время работы 2 станка

% Целевые функции
f1 = @(X) 30*X(1) + 20*X(3); % -> max
f2 = @(X) 3*(X(1)+X(2))+12*(X(3)+X(4)); % -> min
f3 = @(X) 45*X(2) + 21*X(4); % -> max
z1 = @(N) -f1(N); % -> min
z3 = @(N) -f3(N); % -> min

% Обобщенный критерий
z1_opt = -9160;
f2_opt = 1814.4;
z3_opt = -12804;

f = @(N) (1-z1(N)/z1_opt)^2+(1-f2(N)/f2_opt)^2+(1-z3(N)/z3_opt)^2;
% Функциональные ограничения
A = [
    1,1,5,5;
    -1,-1,-5,-5;
    -2,-2,-7,-7;
    1,1,0,0;
    0,0,1,1];
b = [Tmax1;-Tmin1;  -Tmin2;  5000; 9000];
Aeq = [];
beq = [];
% Параметрические ограничения
lb = [0; 0; 0; 0];
ub = [5000; 5000; 9000; 9000];
% Опции оптимизатора
options = optimoptions('fmincon','Display','none');
startingPoint = [0, 0, 0, 0];
% Параметры для задачи стохастического программирования
alpha = 0.1:0.1:0.9;
Ka = icdf('Normal', alpha, 0, 1); % Квантили распределения N(0,1)
global K
global m1; global m2; global m3; global m4
global d1; global d2; global d3; global d4
m1=2;m2=2;m3=7;m4=7;
d1=1;d2=1;d3=3.5;d4=3.5;
% Решение детерминированной задачи:
[Ndet, ~] = fmincon(f, startingPoint,[2,2,7,7; A], [Tmax2; b], Aeq, beq, lb, ub, [], options);
% Решение стохастической задачи:
N = zeros(4,numel(alpha));
for i = 1:numel(alpha)
 K = Ka(i);
 [N(:,i), ~] = fmincon(f, startingPoint, ...
 A, b, Aeq, beq, lb, ub, @nonlin, options);
end
%% Вывод результатов
F1 = cellfun(f1, num2cell(N,1));
F2 = cellfun(f2, num2cell(N,1));
F3 = cellfun(f3, num2cell(N,1));
fprintf('alpha = %.1f, X_11 = %6.4f, X_12 = %6.4f, x_21 = %6.4f, x_22 = %6.3f, f1 = %.2f, f2 = %.0f, f3 = %.2f\n', ...
 [alpha; N(1,:); N(2,:); N(3,:); N(4,:); F1; F2; F3])
fprintf('Для детерминированных ограничений:\n')
fprintf('X_11 = %3.4f, X_12 = %3.4f, x_21 = %6.4f, x_22 = %6.3f, f1 = %.2f, f2 = %.0f, f3 = %.2f\n', ...
 Ndet(1), Ndet(2), Ndet(3), Ndet(4), f1(Ndet), f2(Ndet), f3(Ndet))
%% Функция, задающая нелинейные ограничения
function [c, ceq] = nonlin(N)
global K;
global m1; global m2; global m3; global m4
global d1; global d2; global d3; global d4
  c = m1*N(1)+m2*N(2) + m3*N(3)+m4*N(4) + K*sqrt(d1*N(1)^2 + d2*N(2)^2 + d3*N(3)^2 + d4*N(4)^2) - 1200;
 ceq = [];
end
\end{lstlisting}

\section*{Приложение 4}
\textbf{Скрипт для нахождения мат. ожидания, производных, дисперсии}
\begin{lstlisting}[language={matlab}, caption={Код Matlab}]
clc
%Исходные данные
%М — математическое ожидание
%D — дисперсия
%P — вероятность
P12 = 1; M12 = 20; D12 = 9; 
P22 = 0.6; M22 = 30; D22 = 16; 
P23 = 0.4; M23 = 40; D23 = 25; 
P32 = 0.5; M32 = 28; D32 = 16; 
P34 = 0.5; M34 = 37; D34 = 16; 
P45 = 1; M45 = 30; D45 = 25; 
P51 = 0.2; M51 = 30; D51 = 16; 
P55 = 0.1; M55 = 10; D55 = 4; 
P56 = 0.7; M56 = 30; D56 = 16; 
 
syms s
%W функции
W12 = P12*exp(M12*s+D12/2*s^2);
W22 = P22*exp(M22*s+D22/2*s^2);
W23 = P23*exp(M23*s+D23/2*s^2);
W32 = P32*exp(M32*s+D32/2*s^2);
W34 = P34*exp(M34*s+D34/2*s^2);
W45 = P45*exp(M45*s+D45/2*s^2);
W51 = P51*exp(M51*s+D52/2*s^2);
W55 = P55*exp(M55*s+D55/2*s^2);
W56 = P56*exp(M56*s+D56/2*s^2);
 
We = (W12*W23*W34*W45*W56)/(1 — W12*W23*W34*W45*W51 — W22 — W23*W32 — W55+W22*W55+W55*W23*W32);
 
We = simplify(We)
We0 = subs(We, 's', 0)  % We(0)
 
% Нахождение мат. ожидания и дисперсии
Me = We/We0;
 
% Нахождение производной первого порядка при s=0
m1 = diff(Me, 's');     
m1 = subs(m1, 's', 0)   % Замена символа s на 0 в выражении m1
 
% Нахождение производной второго порядка при s=0
m2 = diff(Me, 's',2);
m2=subs(m2, 's', 0)     % Замена символа s на 0 в выражении m2
 
% Нахождение дисперсии времени выхода процесса в завершающий узел графа
D = m2 — (m1)^2
\end{lstlisting}

\section*{Приложение 5}
\textbf{Алгебра потоковых графов}
\begin{lstlisting}[language={matlab}, caption={Matlab скрипт}, basicstyle=\ttfamily]
clc; clearvars

syms q12
syms q22
syms q23
syms q32
syms q34
syms q45
syms q51
syms q55
syms q56
syms w61
syms s

Q=[0 q12 0 0 0 0;
   0 q22 q23 0 0 0;
   0 q32 0 q34 0 0;
   0 0 0 0 q45 0;
   q51 0 0 0 q55 q56;
   w61 0 0 0 0 0];

A1 = eye(size(Q,1)) - transpose(Q);
disp(A1);

det_A1 = det(A1);

det_dw=diff(det_A1, w61);

det2_A1=subs(det_A1, w61, 0);

We= -det_dw/det2_A1;
disp(We);
\end{lstlisting}


\section*{Приложение 6}
\textbf{Скрипт для нахождения мат. ожидания, производных, дисперсии}
\begin{lstlisting}[language={matlab}, caption={Matlab скрипт}]
clc; clearvars

%М — математическое ожидание
%D — дисперсия
%P — вероятность
P12 = 1; M12 = 20; D12 = 9; 
P22 = 0.6; M22 = 30; D22 = 16; 
P23 = 0.4; M23 = 40; D23 = 25; 
P32 = 0.5; M32 = 28; D32 = 16; 
P34 = 0.5; M34 = 37; D34 = 16; 
P45 = 1; M45 = 30; D45 = 25; 
P51 = 0.2; M51 = 30; D51 = 16; 
P55 = 0.1; M55 = 10; D55 = 4; 
P56 = 0.7; M56 = 30; D56 = 16; 

syms q12
syms q22
syms q23
syms q32
syms q34
syms q45
syms q51
syms q55
syms q56
syms w61
syms s

Q=[0 q12 0 0 0 0;
   0 q22 q23 0 0 0;
   0 q32 0 q34 0 0;
   0 0 0 0 q45 0;
   q51 0 0 0 q55 q56;
   w61 0 0 0 0 0];

A1 = eye(size(Q,1)) - transpose(Q);
disp(A1);

det_A1 = det(A1);
disp(det_A1);

det_dw=diff(det_A1, w61);
disp(det_dw);

det2_A1=subs(det_A1, w61, 0);
disp(det2_A1);

We= -det_dw/det2_A1;
disp(We);


syms s

We=subs(We, q12, P12*exp(M12*s+D12/2*s^2));
We=subs(We, q22, P22*exp(M22*s+D22/2*s^2));
We=subs(We, q23, P23*exp(M23*s+D23/2*s^2));
We=subs(We, q32, P32*exp(M32*s+D32/2*s^2));
We=subs(We, q34, P34*exp(M34*s+D34/2*s^2));
We=subs(We, q45, P45*exp(M45*s+D45/2*s^2));
We=subs(We, q51, P51*exp(M51*s+D51/2*s^2));
We=subs(We, q55, P55*exp(M55*s+D55/2*s^2));
We=subs(We, q56, P56*exp(M56*s+D56/2*s^2));

We = simplify(We)
We0 = subs(We, 's', 0)  % We(0)
 
% Нахождение мат. ожидания и дисперсии
Me = We/We0;
 
% Нахождение производной 1-го порядка при s=0
m1 = diff(Me, 's');     
m1 = subs(m1, 's', 0)   % Замена символа s на 0 в выражении m1
 
% Нахождение производной 2-го порядка при s=0
m2 = diff(Me, 's',2);
m2=subs(m2, 's', 0)     % Замена символа s на 0 в выражении m2
 
% Нахождение дисперсии времени выхода процесса в завершающий узел графа
D = m2 - (m1)^2
\end{lstlisting}



\end{document}
